{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}(); // Internal Imports\n\n\nimport { Component } from \"../component\";\nimport { DOMUtils } from \"../../services\";\nimport { Tools } from \"../../tools\";\nimport { CalloutDirections, Roles, Events, Alignments } from \"../../interfaces\"; // D3 Imports\n\nimport { select } from \"d3-selection\";\nimport { arc, pie } from \"d3-shape\";\nimport { interpolate } from \"d3-interpolate\"; // Pie slice tween function\n\nfunction arcTween(a, arcFunc) {\n  var _this = this;\n\n  var i = interpolate(this._current, a);\n  return function (t) {\n    _this._current = i(t);\n    return arcFunc(_this._current);\n  };\n}\n\nvar Pie =\n/** @class */\nfunction (_super) {\n  __extends(Pie, _super);\n\n  function Pie() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.type = \"pie\"; // Highlight elements that match the hovered legend item\n\n    _this.handleLegendOnHover = function (event) {\n      var hoveredElement = event.detail.hoveredElement;\n\n      var groupMapsTo = _this.model.getOptions().data.groupMapsTo;\n\n      _this.parent.selectAll(\"path.slice\").transition(_this.services.transitions.getTransition(\"legend-hover-bar\")).attr(\"opacity\", function (d) {\n        return d.data[groupMapsTo] !== hoveredElement.datum()[\"name\"] ? 0.3 : 1;\n      });\n    }; // Un-highlight all elements\n\n\n    _this.handleLegendMouseOut = function (event) {\n      _this.parent.selectAll(\"path.slice\").transition(_this.services.transitions.getTransition(\"legend-mouseout-bar\")).attr(\"opacity\", 1);\n    };\n\n    return _this;\n  }\n\n  Pie.prototype.init = function () {\n    var eventsFragment = this.services.events; // Highlight correct circle on legend item hovers\n\n    eventsFragment.addEventListener(Events.Legend.ITEM_HOVER, this.handleLegendOnHover); // Un-highlight circles on legend item mouseouts\n\n    eventsFragment.addEventListener(Events.Legend.ITEM_MOUSEOUT, this.handleLegendMouseOut);\n  };\n\n  Pie.prototype.getInnerRadius = function () {\n    var options = this.model.getOptions();\n    return options.pie.innerRadius;\n  };\n\n  Pie.prototype.render = function (animate) {\n    if (animate === void 0) {\n      animate = true;\n    }\n\n    var self = this;\n    var svg = this.getContainerSVG();\n    var displayData = this.model.getDisplayData();\n    var options = this.model.getOptions();\n    var groupMapsTo = options.data.groupMapsTo; // Compute the outer radius needed\n\n    var radius = this.computeRadius();\n    this.arc = arc().innerRadius(this.getInnerRadius()).outerRadius(radius); // Set the hover arc radius\n\n    this.hoverArc = arc().innerRadius(this.getInnerRadius()).outerRadius(radius + options.pie.hoverArc.outerRadiusOffset); // Setup the pie layout\n\n    var pieLayout = pie().value(function (d) {\n      return d.value;\n    }).sort(null).padAngle(options.pie.padAngle); // Sort pie layout data based off of the indecies the layout creates\n\n    var pieLayoutData = pieLayout(displayData).sort(function (a, b) {\n      return a.index - b.index;\n    }); // Update data on all slices\n\n    var slicesGroup = DOMUtils.appendOrSelect(svg, \"g.slices\").attr(\"role\", Roles.GROUP).attr(\"aria-label\", \"slices\");\n    var paths = slicesGroup.selectAll(\"path.slice\").data(pieLayoutData, function (d) {\n      return d.data[groupMapsTo];\n    }); // Remove slices that need to be exited\n\n    paths.exit().attr(\"opacity\", 0).remove(); // Add new slices that are being introduced\n\n    var enteringPaths = paths.enter().append(\"path\").classed(\"slice\", true).attr(\"opacity\", 0); // Update styles & position on existing and entering slices\n\n    enteringPaths.merge(paths).attr(\"fill\", function (d) {\n      return self.model.getFillColor(d.data[groupMapsTo]);\n    }).attr(\"d\", this.arc).transition(this.services.transitions.getTransition(\"pie-slice-enter-update\", animate)).attr(\"opacity\", 1) // a11y\n    .attr(\"role\", Roles.GRAPHICS_SYMBOL).attr(\"aria-roledescription\", \"slice\").attr(\"aria-label\", function (d) {\n      return d.value + \", \" + (Tools.convertValueToPercentage(d.data.value, displayData) + \"%\");\n    }) // Tween\n    .attrTween(\"d\", function (a) {\n      return arcTween.bind(this)(a, self.arc);\n    }); // Draw the slice labels\n\n    var labelData = pieLayoutData.filter(function (x) {\n      return x.value > 0;\n    });\n    var labelsGroup = DOMUtils.appendOrSelect(svg, \"g.labels\").attr(\"role\", Roles.GROUP).attr(\"aria-label\", \"labels\");\n    var labels = labelsGroup.selectAll(\"text.pie-label\").data(labelData, function (d) {\n      return d.data[groupMapsTo];\n    }); // Remove labels that are existing\n\n    labels.exit().attr(\"opacity\", 0).remove(); // Add labels that are being introduced\n\n    var enteringLabels = labels.enter().append(\"text\").classed(\"pie-label\", true); // Update styles & position on existing & entering labels\n\n    var calloutData = [];\n    enteringLabels.merge(labels).style(\"text-anchor\", \"middle\").text(function (d) {\n      if (options.pie.labels.formatter) {\n        return options.pie.labels.formatter(d);\n      }\n\n      return Tools.convertValueToPercentage(d.data.value, displayData) + \"%\";\n    }) // Calculate dimensions in order to transform\n    .datum(function (d) {\n      var marginedRadius = radius + 7;\n      var theta = (d.endAngle - d.startAngle) / 2 + d.startAngle;\n      var deg = theta / Math.PI * 180;\n      var textLength = this.getComputedTextLength();\n      d.textOffsetX = textLength / 2;\n      d.textOffsetY = deg > 90 && deg < 270 ? 10 : 0;\n      d.xPosition = (d.textOffsetX + marginedRadius) * Math.sin(theta);\n      d.yPosition = (d.textOffsetY + marginedRadius) * -Math.cos(theta);\n      return d;\n    }).attr(\"transform\", function (d, i) {\n      var totalSlices = labelData.length;\n      var sliceAngleDeg = (d.endAngle - d.startAngle) * (180 / Math.PI); // check if last 2 slices (or just last) are < the threshold\n\n      if (i >= totalSlices - 2) {\n        if (sliceAngleDeg < options.pie.callout.minSliceDegree) {\n          var labelTranslateX = void 0,\n              labelTranslateY = void 0;\n\n          if (d.index === totalSlices - 1) {\n            labelTranslateX = d.xPosition + options.pie.callout.offsetX + options.pie.callout.textMargin + d.textOffsetX;\n            labelTranslateY = d.yPosition - options.pie.callout.offsetY; // Set direction of callout\n\n            d.direction = CalloutDirections.RIGHT;\n            calloutData.push(d);\n          } else {\n            labelTranslateX = d.xPosition - options.pie.callout.offsetX - d.textOffsetX - options.pie.callout.textMargin;\n            labelTranslateY = d.yPosition - options.pie.callout.offsetY; // Set direction of callout\n\n            d.direction = CalloutDirections.LEFT;\n            calloutData.push(d);\n          }\n\n          return \"translate(\" + labelTranslateX + \", \" + labelTranslateY + \")\";\n        }\n      }\n\n      return \"translate(\" + d.xPosition + \", \" + d.yPosition + \")\";\n    }); // Render pie label callouts\n\n    this.renderCallouts(calloutData);\n    var optionName = Tools.getProperty(options, \"donut\") ? \"donut\" : \"pie\";\n    var alignment = Tools.getProperty(options, optionName, \"alignment\");\n    var width = DOMUtils.getSVGElementSize(this.getParent(), {\n      useAttr: true\n    }).width; // Position Pie\n\n    var pieTranslateX = radius + options.pie.xOffset;\n\n    if (alignment === Alignments.CENTER) {\n      pieTranslateX = width / 2;\n    } else if (alignment === Alignments.RIGHT) {\n      pieTranslateX = width - radius - options.pie.xOffset;\n    }\n\n    var pieTranslateY = radius + options.pie.yOffset;\n\n    if (calloutData.length > 0) {\n      pieTranslateY += options.pie.yOffsetCallout;\n    }\n\n    svg.attr(\"transform\", \"translate(\" + pieTranslateX + \", \" + pieTranslateY + \")\"); // Add event listeners\n\n    this.addEventListeners();\n  };\n\n  Pie.prototype.renderCallouts = function (calloutData) {\n    var svg = DOMUtils.appendOrSelect(this.getContainerSVG(), \"g.callouts\").attr(\"role\", Roles.GROUP).attr(\"aria-label\", \"callouts\");\n    var options = this.model.getOptions(); // Update data on callouts\n\n    var callouts = svg.selectAll(\"g.callout\").data(calloutData);\n    callouts.exit().remove();\n    var enteringCallouts = callouts.enter().append(\"g\").classed(\"callout\", true) // a11y\n    .attr(\"role\", Roles.GRAPHICS_SYMBOL + \" \" + Roles.GROUP).attr(\"aria-roledescription\", \"label callout\"); // Update data values for each callout\n    // For the horizontal and vertical lines to use\n\n    enteringCallouts.merge(callouts).datum(function (d) {\n      var xPosition = d.xPosition,\n          yPosition = d.yPosition,\n          direction = d.direction;\n\n      if (direction === CalloutDirections.RIGHT) {\n        d.startPos = {\n          x: xPosition,\n          y: yPosition + d.textOffsetY\n        }; // end position for the callout line\n\n        d.endPos = {\n          x: xPosition + options.pie.callout.offsetX,\n          y: yPosition - options.pie.callout.offsetY + d.textOffsetY\n        }; // the intersection point of the vertical and horizontal line\n\n        d.intersectPointX = d.endPos.x - options.pie.callout.horizontalLineLength;\n      } else {\n        // start position for the callout line\n        d.startPos = {\n          x: xPosition,\n          y: yPosition + d.textOffsetY\n        }; // end position for the callout line should be bottom aligned to the title\n\n        d.endPos = {\n          x: xPosition - options.pie.callout.offsetX,\n          y: yPosition - options.pie.callout.offsetY + d.textOffsetY\n        }; // the intersection point of the vertical and horizontal line\n\n        d.intersectPointX = d.endPos.x + options.pie.callout.horizontalLineLength;\n      } // Store the necessary data in the DOM element\n\n\n      return d;\n    }); // draw vertical line\n\n    var enteringVerticalLines = enteringCallouts.append(\"line\").classed(\"vertical-line\", true);\n    enteringVerticalLines.merge(svg.selectAll(\"line.vertical-line\")).datum(function (d) {\n      return select(this.parentNode).datum();\n    }).style(\"stroke-width\", \"1px\").attr(\"x1\", function (d) {\n      return d.startPos.x;\n    }).attr(\"y1\", function (d) {\n      return d.startPos.y;\n    }).attr(\"x2\", function (d) {\n      return d.intersectPointX;\n    }).attr(\"y2\", function (d) {\n      return d.endPos.y;\n    }); // draw horizontal line\n\n    var enteringHorizontalLines = enteringCallouts.append(\"line\").classed(\"horizontal-line\", true);\n    enteringHorizontalLines.merge(svg.selectAll(\"line.horizontal-line\")).datum(function (d) {\n      return select(this.parentNode).datum();\n    }).style(\"stroke-width\", \"1px\").attr(\"x1\", function (d) {\n      return d.intersectPointX;\n    }).attr(\"y1\", function (d) {\n      return d.endPos.y;\n    }).attr(\"x2\", function (d) {\n      return d.endPos.x;\n    }).attr(\"y2\", function (d) {\n      return d.endPos.y;\n    });\n  };\n\n  Pie.prototype.addEventListeners = function () {\n    var self = this;\n    this.parent.selectAll(\"path.slice\").on(\"mouseover\", function (datum) {\n      var hoveredElement = select(this);\n      hoveredElement.classed(\"hovered\", true).transition(self.services.transitions.getTransition(\"pie_slice_mouseover\")).attr(\"d\", self.hoverArc); // Dispatch mouse event\n\n      self.services.events.dispatchEvent(Events.Pie.SLICE_MOUSEOVER, {\n        element: select(this),\n        datum: datum\n      });\n      var groupMapsTo = self.model.getOptions().data.groupMapsTo; // Show tooltip\n\n      self.services.events.dispatchEvent(Events.Tooltip.SHOW, {\n        hoveredElement: hoveredElement,\n        items: [{\n          label: datum.data[groupMapsTo],\n          value: datum.data.value,\n          color: self.model.getStrokeColor(datum.data[groupMapsTo])\n        }]\n      });\n    }).on(\"mousemove\", function (datum) {\n      var hoveredElement = select(this); // Dispatch mouse event\n\n      self.services.events.dispatchEvent(Events.Pie.SLICE_MOUSEMOVE, {\n        element: hoveredElement,\n        datum: datum\n      }); // Show tooltip\n\n      self.services.events.dispatchEvent(Events.Tooltip.MOVE);\n    }).on(\"click\", function (datum) {\n      // Dispatch mouse event\n      self.services.events.dispatchEvent(Events.Pie.SLICE_CLICK, {\n        element: select(this),\n        datum: datum\n      });\n    }).on(\"mouseout\", function (datum) {\n      var hoveredElement = select(this);\n      hoveredElement.classed(\"hovered\", false).transition(self.services.transitions.getTransition(\"pie_slice_mouseover\")).attr(\"d\", self.arc); // Dispatch mouse event\n\n      self.services.events.dispatchEvent(Events.Pie.SLICE_MOUSEOUT, {\n        element: hoveredElement,\n        datum: datum\n      }); // Hide tooltip\n\n      self.services.events.dispatchEvent(Events.Tooltip.HIDE, {\n        hoveredElement: hoveredElement\n      });\n    });\n  }; // Helper functions\n\n\n  Pie.prototype.computeRadius = function () {\n    var options = this.model.getOptions();\n\n    var _a = DOMUtils.getSVGElementSize(this.parent, {\n      useAttrs: true\n    }),\n        width = _a.width,\n        height = _a.height;\n\n    var radius = Math.min(width, height) / 2;\n    return radius + options.pie.radiusOffset;\n  };\n\n  return Pie;\n}(Component);\n\nexport { Pie };","map":{"version":3,"sources":["/Users/nicholasrenotte/Desktop/Regression/app/client/node_modules/@carbon/charts/components/graphs/pie.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","Component","DOMUtils","Tools","CalloutDirections","Roles","Events","Alignments","select","arc","pie","interpolate","arcTween","a","arcFunc","_this","i","_current","t","Pie","_super","apply","arguments","type","handleLegendOnHover","event","hoveredElement","detail","groupMapsTo","model","getOptions","data","parent","selectAll","transition","services","transitions","getTransition","attr","datum","handleLegendMouseOut","init","eventsFragment","events","addEventListener","Legend","ITEM_HOVER","ITEM_MOUSEOUT","getInnerRadius","options","innerRadius","render","animate","self","svg","getContainerSVG","displayData","getDisplayData","radius","computeRadius","outerRadius","hoverArc","outerRadiusOffset","pieLayout","value","sort","padAngle","pieLayoutData","index","slicesGroup","appendOrSelect","GROUP","paths","exit","remove","enteringPaths","enter","append","classed","merge","getFillColor","GRAPHICS_SYMBOL","convertValueToPercentage","attrTween","bind","labelData","filter","x","labelsGroup","labels","enteringLabels","calloutData","style","text","formatter","marginedRadius","theta","endAngle","startAngle","deg","Math","PI","textLength","getComputedTextLength","textOffsetX","textOffsetY","xPosition","sin","yPosition","cos","totalSlices","length","sliceAngleDeg","callout","minSliceDegree","labelTranslateX","labelTranslateY","offsetX","textMargin","offsetY","direction","RIGHT","push","LEFT","renderCallouts","optionName","getProperty","alignment","width","getSVGElementSize","getParent","useAttr","pieTranslateX","xOffset","CENTER","pieTranslateY","yOffset","yOffsetCallout","addEventListeners","callouts","enteringCallouts","startPos","y","endPos","intersectPointX","horizontalLineLength","enteringVerticalLines","parentNode","enteringHorizontalLines","on","dispatchEvent","SLICE_MOUSEOVER","element","Tooltip","SHOW","items","label","color","getStrokeColor","SLICE_MOUSEMOVE","MOVE","SLICE_CLICK","SLICE_MOUSEOUT","HIDE","_a","useAttrs","height","min","radiusOffset"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n// Internal Imports\nimport { Component } from \"../component\";\nimport { DOMUtils } from \"../../services\";\nimport { Tools } from \"../../tools\";\nimport { CalloutDirections, Roles, Events, Alignments } from \"../../interfaces\";\n// D3 Imports\nimport { select } from \"d3-selection\";\nimport { arc, pie } from \"d3-shape\";\nimport { interpolate } from \"d3-interpolate\";\n// Pie slice tween function\nfunction arcTween(a, arcFunc) {\n    var _this = this;\n    var i = interpolate(this._current, a);\n    return function (t) {\n        _this._current = i(t);\n        return arcFunc(_this._current);\n    };\n}\nvar Pie = /** @class */ (function (_super) {\n    __extends(Pie, _super);\n    function Pie() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.type = \"pie\";\n        // Highlight elements that match the hovered legend item\n        _this.handleLegendOnHover = function (event) {\n            var hoveredElement = event.detail.hoveredElement;\n            var groupMapsTo = _this.model.getOptions().data.groupMapsTo;\n            _this.parent\n                .selectAll(\"path.slice\")\n                .transition(_this.services.transitions.getTransition(\"legend-hover-bar\"))\n                .attr(\"opacity\", function (d) {\n                return d.data[groupMapsTo] !== hoveredElement.datum()[\"name\"] ? 0.3 : 1;\n            });\n        };\n        // Un-highlight all elements\n        _this.handleLegendMouseOut = function (event) {\n            _this.parent\n                .selectAll(\"path.slice\")\n                .transition(_this.services.transitions.getTransition(\"legend-mouseout-bar\"))\n                .attr(\"opacity\", 1);\n        };\n        return _this;\n    }\n    Pie.prototype.init = function () {\n        var eventsFragment = this.services.events;\n        // Highlight correct circle on legend item hovers\n        eventsFragment.addEventListener(Events.Legend.ITEM_HOVER, this.handleLegendOnHover);\n        // Un-highlight circles on legend item mouseouts\n        eventsFragment.addEventListener(Events.Legend.ITEM_MOUSEOUT, this.handleLegendMouseOut);\n    };\n    Pie.prototype.getInnerRadius = function () {\n        var options = this.model.getOptions();\n        return options.pie.innerRadius;\n    };\n    Pie.prototype.render = function (animate) {\n        if (animate === void 0) { animate = true; }\n        var self = this;\n        var svg = this.getContainerSVG();\n        var displayData = this.model.getDisplayData();\n        var options = this.model.getOptions();\n        var groupMapsTo = options.data.groupMapsTo;\n        // Compute the outer radius needed\n        var radius = this.computeRadius();\n        this.arc = arc().innerRadius(this.getInnerRadius()).outerRadius(radius);\n        // Set the hover arc radius\n        this.hoverArc = arc()\n            .innerRadius(this.getInnerRadius())\n            .outerRadius(radius + options.pie.hoverArc.outerRadiusOffset);\n        // Setup the pie layout\n        var pieLayout = pie()\n            .value(function (d) { return d.value; })\n            .sort(null)\n            .padAngle(options.pie.padAngle);\n        // Sort pie layout data based off of the indecies the layout creates\n        var pieLayoutData = pieLayout(displayData).sort(function (a, b) { return a.index - b.index; });\n        // Update data on all slices\n        var slicesGroup = DOMUtils.appendOrSelect(svg, \"g.slices\")\n            .attr(\"role\", Roles.GROUP)\n            .attr(\"aria-label\", \"slices\");\n        var paths = slicesGroup\n            .selectAll(\"path.slice\")\n            .data(pieLayoutData, function (d) { return d.data[groupMapsTo]; });\n        // Remove slices that need to be exited\n        paths.exit().attr(\"opacity\", 0).remove();\n        // Add new slices that are being introduced\n        var enteringPaths = paths\n            .enter()\n            .append(\"path\")\n            .classed(\"slice\", true)\n            .attr(\"opacity\", 0);\n        // Update styles & position on existing and entering slices\n        enteringPaths\n            .merge(paths)\n            .attr(\"fill\", function (d) { return self.model.getFillColor(d.data[groupMapsTo]); })\n            .attr(\"d\", this.arc)\n            .transition(this.services.transitions.getTransition(\"pie-slice-enter-update\", animate))\n            .attr(\"opacity\", 1)\n            // a11y\n            .attr(\"role\", Roles.GRAPHICS_SYMBOL)\n            .attr(\"aria-roledescription\", \"slice\")\n            .attr(\"aria-label\", function (d) {\n            return d.value + \", \" + (Tools.convertValueToPercentage(d.data.value, displayData) + \"%\");\n        })\n            // Tween\n            .attrTween(\"d\", function (a) {\n            return arcTween.bind(this)(a, self.arc);\n        });\n        // Draw the slice labels\n        var labelData = pieLayoutData.filter(function (x) { return x.value > 0; });\n        var labelsGroup = DOMUtils.appendOrSelect(svg, \"g.labels\")\n            .attr(\"role\", Roles.GROUP)\n            .attr(\"aria-label\", \"labels\");\n        var labels = labelsGroup\n            .selectAll(\"text.pie-label\")\n            .data(labelData, function (d) { return d.data[groupMapsTo]; });\n        // Remove labels that are existing\n        labels.exit().attr(\"opacity\", 0).remove();\n        // Add labels that are being introduced\n        var enteringLabels = labels\n            .enter()\n            .append(\"text\")\n            .classed(\"pie-label\", true);\n        // Update styles & position on existing & entering labels\n        var calloutData = [];\n        enteringLabels\n            .merge(labels)\n            .style(\"text-anchor\", \"middle\")\n            .text(function (d) {\n            if (options.pie.labels.formatter) {\n                return options.pie.labels.formatter(d);\n            }\n            return (Tools.convertValueToPercentage(d.data.value, displayData) +\n                \"%\");\n        })\n            // Calculate dimensions in order to transform\n            .datum(function (d) {\n            var marginedRadius = radius + 7;\n            var theta = (d.endAngle - d.startAngle) / 2 + d.startAngle;\n            var deg = (theta / Math.PI) * 180;\n            var textLength = this.getComputedTextLength();\n            d.textOffsetX = textLength / 2;\n            d.textOffsetY = deg > 90 && deg < 270 ? 10 : 0;\n            d.xPosition =\n                (d.textOffsetX + marginedRadius) * Math.sin(theta);\n            d.yPosition =\n                (d.textOffsetY + marginedRadius) * -Math.cos(theta);\n            return d;\n        })\n            .attr(\"transform\", function (d, i) {\n            var totalSlices = labelData.length;\n            var sliceAngleDeg = (d.endAngle - d.startAngle) * (180 / Math.PI);\n            // check if last 2 slices (or just last) are < the threshold\n            if (i >= totalSlices - 2) {\n                if (sliceAngleDeg < options.pie.callout.minSliceDegree) {\n                    var labelTranslateX = void 0, labelTranslateY = void 0;\n                    if (d.index === totalSlices - 1) {\n                        labelTranslateX =\n                            d.xPosition +\n                                options.pie.callout.offsetX +\n                                options.pie.callout.textMargin +\n                                d.textOffsetX;\n                        labelTranslateY =\n                            d.yPosition - options.pie.callout.offsetY;\n                        // Set direction of callout\n                        d.direction = CalloutDirections.RIGHT;\n                        calloutData.push(d);\n                    }\n                    else {\n                        labelTranslateX =\n                            d.xPosition -\n                                options.pie.callout.offsetX -\n                                d.textOffsetX -\n                                options.pie.callout.textMargin;\n                        labelTranslateY =\n                            d.yPosition - options.pie.callout.offsetY;\n                        // Set direction of callout\n                        d.direction = CalloutDirections.LEFT;\n                        calloutData.push(d);\n                    }\n                    return \"translate(\" + labelTranslateX + \", \" + labelTranslateY + \")\";\n                }\n            }\n            return \"translate(\" + d.xPosition + \", \" + d.yPosition + \")\";\n        });\n        // Render pie label callouts\n        this.renderCallouts(calloutData);\n        var optionName = Tools.getProperty(options, \"donut\") ? \"donut\" : \"pie\";\n        var alignment = Tools.getProperty(options, optionName, \"alignment\");\n        var width = DOMUtils.getSVGElementSize(this.getParent(), { useAttr: true }).width;\n        // Position Pie\n        var pieTranslateX = radius + options.pie.xOffset;\n        if (alignment === Alignments.CENTER) {\n            pieTranslateX = width / 2;\n        }\n        else if (alignment === Alignments.RIGHT) {\n            pieTranslateX = width - radius - options.pie.xOffset;\n        }\n        var pieTranslateY = radius + options.pie.yOffset;\n        if (calloutData.length > 0) {\n            pieTranslateY += options.pie.yOffsetCallout;\n        }\n        svg.attr(\"transform\", \"translate(\" + pieTranslateX + \", \" + pieTranslateY + \")\");\n        // Add event listeners\n        this.addEventListeners();\n    };\n    Pie.prototype.renderCallouts = function (calloutData) {\n        var svg = DOMUtils.appendOrSelect(this.getContainerSVG(), \"g.callouts\")\n            .attr(\"role\", Roles.GROUP)\n            .attr(\"aria-label\", \"callouts\");\n        var options = this.model.getOptions();\n        // Update data on callouts\n        var callouts = svg.selectAll(\"g.callout\").data(calloutData);\n        callouts.exit().remove();\n        var enteringCallouts = callouts\n            .enter()\n            .append(\"g\")\n            .classed(\"callout\", true)\n            // a11y\n            .attr(\"role\", Roles.GRAPHICS_SYMBOL + \" \" + Roles.GROUP)\n            .attr(\"aria-roledescription\", \"label callout\");\n        // Update data values for each callout\n        // For the horizontal and vertical lines to use\n        enteringCallouts.merge(callouts).datum(function (d) {\n            var xPosition = d.xPosition, yPosition = d.yPosition, direction = d.direction;\n            if (direction === CalloutDirections.RIGHT) {\n                d.startPos = {\n                    x: xPosition,\n                    y: yPosition + d.textOffsetY\n                };\n                // end position for the callout line\n                d.endPos = {\n                    x: xPosition + options.pie.callout.offsetX,\n                    y: yPosition - options.pie.callout.offsetY + d.textOffsetY\n                };\n                // the intersection point of the vertical and horizontal line\n                d.intersectPointX =\n                    d.endPos.x - options.pie.callout.horizontalLineLength;\n            }\n            else {\n                // start position for the callout line\n                d.startPos = {\n                    x: xPosition,\n                    y: yPosition + d.textOffsetY\n                };\n                // end position for the callout line should be bottom aligned to the title\n                d.endPos = {\n                    x: xPosition - options.pie.callout.offsetX,\n                    y: yPosition - options.pie.callout.offsetY + d.textOffsetY\n                };\n                // the intersection point of the vertical and horizontal line\n                d.intersectPointX =\n                    d.endPos.x + options.pie.callout.horizontalLineLength;\n            }\n            // Store the necessary data in the DOM element\n            return d;\n        });\n        // draw vertical line\n        var enteringVerticalLines = enteringCallouts\n            .append(\"line\")\n            .classed(\"vertical-line\", true);\n        enteringVerticalLines\n            .merge(svg.selectAll(\"line.vertical-line\"))\n            .datum(function (d) {\n            return select(this.parentNode).datum();\n        })\n            .style(\"stroke-width\", \"1px\")\n            .attr(\"x1\", function (d) { return d.startPos.x; })\n            .attr(\"y1\", function (d) { return d.startPos.y; })\n            .attr(\"x2\", function (d) { return d.intersectPointX; })\n            .attr(\"y2\", function (d) { return d.endPos.y; });\n        // draw horizontal line\n        var enteringHorizontalLines = enteringCallouts\n            .append(\"line\")\n            .classed(\"horizontal-line\", true);\n        enteringHorizontalLines\n            .merge(svg.selectAll(\"line.horizontal-line\"))\n            .datum(function (d) {\n            return select(this.parentNode).datum();\n        })\n            .style(\"stroke-width\", \"1px\")\n            .attr(\"x1\", function (d) { return d.intersectPointX; })\n            .attr(\"y1\", function (d) { return d.endPos.y; })\n            .attr(\"x2\", function (d) { return d.endPos.x; })\n            .attr(\"y2\", function (d) { return d.endPos.y; });\n    };\n    Pie.prototype.addEventListeners = function () {\n        var self = this;\n        this.parent\n            .selectAll(\"path.slice\")\n            .on(\"mouseover\", function (datum) {\n            var hoveredElement = select(this);\n            hoveredElement\n                .classed(\"hovered\", true)\n                .transition(self.services.transitions.getTransition(\"pie_slice_mouseover\"))\n                .attr(\"d\", self.hoverArc);\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.Pie.SLICE_MOUSEOVER, {\n                element: select(this),\n                datum: datum\n            });\n            var groupMapsTo = self.model.getOptions().data.groupMapsTo;\n            // Show tooltip\n            self.services.events.dispatchEvent(Events.Tooltip.SHOW, {\n                hoveredElement: hoveredElement,\n                items: [\n                    {\n                        label: datum.data[groupMapsTo],\n                        value: datum.data.value,\n                        color: self.model.getStrokeColor(datum.data[groupMapsTo])\n                    }\n                ]\n            });\n        })\n            .on(\"mousemove\", function (datum) {\n            var hoveredElement = select(this);\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.Pie.SLICE_MOUSEMOVE, {\n                element: hoveredElement,\n                datum: datum\n            });\n            // Show tooltip\n            self.services.events.dispatchEvent(Events.Tooltip.MOVE);\n        })\n            .on(\"click\", function (datum) {\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.Pie.SLICE_CLICK, {\n                element: select(this),\n                datum: datum\n            });\n        })\n            .on(\"mouseout\", function (datum) {\n            var hoveredElement = select(this);\n            hoveredElement\n                .classed(\"hovered\", false)\n                .transition(self.services.transitions.getTransition(\"pie_slice_mouseover\"))\n                .attr(\"d\", self.arc);\n            // Dispatch mouse event\n            self.services.events.dispatchEvent(Events.Pie.SLICE_MOUSEOUT, {\n                element: hoveredElement,\n                datum: datum\n            });\n            // Hide tooltip\n            self.services.events.dispatchEvent(Events.Tooltip.HIDE, {\n                hoveredElement: hoveredElement\n            });\n        });\n    };\n    // Helper functions\n    Pie.prototype.computeRadius = function () {\n        var options = this.model.getOptions();\n        var _a = DOMUtils.getSVGElementSize(this.parent, {\n            useAttrs: true\n        }), width = _a.width, height = _a.height;\n        var radius = Math.min(width, height) / 2;\n        return radius + options.pie.radiusOffset;\n    };\n    return Pie;\n}(Component));\nexport { Pie };\n//# sourceMappingURL=../../../src/components/graphs/pie.js.map"]},"metadata":{},"sourceType":"module"}